


Overview

The Dynamic Duty Creation Module automates the process of assigning duties to soldiers while respecting manpower requirements, soldier availability, and rank hierarchy. It supports two types of duties:
Roster Duties – automatically generated from the duties table.
Fixed Duties – based on predefined soldier commitments such as courses, cadres, or services.

Key Validation Rules:

Duty status check: Only Active duties can be used for roster generation.
Unique assignment: A soldier cannot be double-booked for the same date.
Fair rotation: Prevent consecutive same duty for the same soldier.
Exclusion logic: Soldiers with active cadre/course/service are skipped.
Leave/availability check: Ensure soldier is not on leave before assigning.


Business Rules
1. Roster Duties

 - Roster duties are generated using active records from the duties table.
 - Each duty has:
	duty_id
	start_time / end_time
	manpower requirement

Soldiers are assigned to these duties according to:
	- Rank match → only soldiers of the correct rank are considered.
	- Manpower count → assign as many soldiers as required.
	- Fair distribution rule → avoid assigning the same soldier to the same duty type on consecutive days (e.g., no back-to-back night guard).

    - Fairness check → no back-to-back same duty (e.g., no consecutive night guards).
	Exclusions → exclude soldiers who:
	   - Are in active cadre/course/service on the given date.
	   - Are on leave.

Assigned roster duties are stored in the soldier_duties table.
Exclusions:
    - Soldiers currently on cadres, courses, or services (soldier_cadres, soldier_courses, soldier_services) are excluded since they have fixed assignments.

2. Fixed Duties
   - Soldiers with scheduled cadres, courses, or services are treated as already assigned to a duty during that period.
Rules:
  - Only active soldiers are considered (not on leave).
  - Dates must fall within start_date and end_date of their cadre/course/service.
  - These fixed duties override any roster assignment for the same period.

Actions:
  keep soldier_cadres, soldier_courses, soldier_services as the source of truth.
  Whenever display or calculate a soldier’s duty for a date, you merge dynamic (roster) duties + fixed duties (derived from those tables).


➡️ Stores only roster duties (auto-generated).
➡️ These remain unchanged. Their records are treated as fixed duties whenever duty assignment/reporting is done.

These are the database tables.
@Bangla71desh*

duties
| Column     | Type   | Description                      |
| ---------- | ------ | -------------------------------- |
| id         | int    | Primary key                      |
| duty_name  | string | Name of duty (e.g., Night Guard) |
| start_time | time   | Duty start time                  |
| end_time   | time   | Duty end time                    |
| remark     | text   | Notes                            |
| status     | string | `Active` / `Inactive`            |
| created_at | ts     | Timestamp                        |
| updated_at | ts     | Timestamp                        |

soldier_services

| Column                 | Type   | Description                        |
| ---------------------- | ------ | ---------------------------------- |
| id                     | int    | Primary key                        |
| soldier_id             | int    | Soldier reference                  |
| appointment_id         | int    | Related appointment                |
| appointments_name      | string | Name of appointment                |
| appointment_type       | string | Type of appointment                |
| appointments_from_date | date   | Start date                         |
| appointments_to_date   | date   | End date                           |
| status                 | enum   | `scheduled`, `active`, `completed` |
| note                   | text   | Additional notes                   |
| created_at             | ts     | Timestamp                          |
| updated_at             | ts     | Timestamp                          |

soldier_cadres

| Column          | Type   | Description                        |
| --------------- | ------ | ---------------------------------- |
| id              | int    | Primary key                        |
| soldier_id      | int    | Soldier reference                  |
| cadre_id        | int    | Related cadre                      |
| result          | string | Result/status                      |
| start_date      | date   | Start date                         |
| end_date        | date   | End date                           |
| completion_date | date   | Completion date                    |
| course_status   | string | Status of course                   |
| remarks         | text   | Notes                              |
| status          | enum   | `scheduled`, `active`, `completed` |
| created_at      | ts     | Timestamp                          |
| updated_at      | ts     | Timestamp                          |

soldier_courses

| Column          | Type   | Description                        |
| --------------- | ------ | ---------------------------------- |
| id              | int    | Primary key                        |
| soldier_id      | int    | Soldier reference                  |
| course_id       | int    | Related course                     |
| result          | string | Result/status                      |
| start_date      | date   | Start date                         |
| end_date        | date   | End date                           |
| completion_date | date   | Completion date                    |
| course_status   | string | Status of course                   |
| remarks         | text   | Notes                              |
| status          | enum   | `scheduled`, `active`, `completed` |
| created_at      | ts     | Timestamp                          |
| updated_at      | ts     | Timestamp                          |

soldier_duties

| Column        | Type | Description                                         |
| ------------- | ---- | --------------------------------------------------- |
| id            | int  | Primary key                                         |
| soldier_id    | int  | Soldier reference                                   |
| duty_id       | int  | Reference to duty                                   |
| assigned_date | date | Date of assignment                                  |
| start_time    | time | Start time of duty                                  |
| end_time      | time | End time of duty                                    |
| status        | enum | `assigned`, `cancelled`, `transferred`, `completed` |
| remarks       | text | Notes                                               |
| created_at    | ts   | Timestamp                                           |
| updated_at    | ts   | Timestamp                                           |

